<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gt.game.core.dao.loveArrow.LovearrowMainDAO">

	<!-- 通用查询映射结果 -->
	<resultMap id="BaseResultMap" type="com.gt.game.core.entity.loveArrow.LovearrowMain">
		<id column="id" property="id" />
		<result column="createtime" property="createtime" />
		<result column="activity_begin_time" property="activityBeginTime" />
		<result column="activity_end_time" property="activityEndTime" />
		<result column="cash_prize_begin_time" property="cashPrizeBeginTime" />
		<result column="cash_prize_end_time" property="cashPrizeEndTime" />
		<result column="act_rule" property="actRule" />
		<result column="name" property="name" />
		<result column="follow_qr_code" property="followQrCode" />
		<result column="man_day_chance" property="manDayChance" />
		<result column="man_total_chance" property="manTotalChance" />
		<result column="cash_prize_instruction" property="cashPrizeInstruction" />
		<result column="receive_type" property="receiveType" />
		<result column="phone" property="phone" />
		<result column="cash_address" property="cashAddress" />
		<result column="bus_id" property="busId" />
		<result column="music_url" property="musicUrl" />
		<result column="bgm_sp" property="bgmSp" />
	</resultMap>
	<resultMap id="BaseResultMap1" type="com.gt.game.core.bean.loveArrow.res.LoveArrowListRes">
		<id column="id" property="id" />
		<result column="activity_begin_time" property="activityBeginTime" />
		<result column="activity_end_time" property="activityEndTime" />
		<result column="name" property="name" />
	</resultMap>
    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        id, createtime, activity_begin_time, activity_end_time, cash_prize_begin_time, cash_prize_end_time, act_rule, name, follow_qr_code, man_day_chance, man_total_chance, cash_prize_instruction, receive_type, phone, cash_address, bus_id, music_url, bgm_sp
    </sql>
	<select id="getLoveArrowList" resultMap="BaseResultMap1" parameterType="Map">
		SELECT  id,activity_begin_time, activity_end_time, name
		FROM t_wx_activity_lovearrow_main
		WHERE bus_id = #{busId,jdbcType=INTEGER}
		<if test="status == 0">
			and UNIX_TIMESTAMP(activity_begin_time) > UNIX_TIMESTAMP(#{nowTime})
		</if>
		<if  test="status == 1">
			and UNIX_TIMESTAMP(activity_begin_time) &lt;= UNIX_TIMESTAMP(#{nowTime}) and  UNIX_TIMESTAMP(activity_end_time) >= UNIX_TIMESTAMP(#{nowTime})
		</if>
		<if test="status == 2">
			and UNIX_TIMESTAMP(activity_end_time) &lt; UNIX_TIMESTAMP(#{nowTime})
		</if>
		<if test="name != null and name != ''">
			and name LIKE CONCAT('%','${name}','%' )
		</if>
		order BY  id DESC
	</select>
	<select id="getCount" resultType="map" parameterType="map">
		SELECT  t1.count2 ,t2.count3 , t3.count4
		FROM (SELECT  count(m1.id) AS count2 FROM  t_wx_activity_lovearrow_main m1
		WHERE m1.bus_id = #{busId,jdbcType=INTEGER} AND UNIX_TIMESTAMP(m1.activity_begin_time) > UNIX_TIMESTAMP(#{nowTime})) t1
		JOIN
		(SELECT count(m2.id) AS count3 FROM  t_wx_activity_lovearrow_main m2
		WHERE m2.bus_id = #{busId,jdbcType=INTEGER} and UNIX_TIMESTAMP(m2.activity_begin_time) &lt;= UNIX_TIMESTAMP(#{nowTime}) and  UNIX_TIMESTAMP(m2.activity_end_time) >= UNIX_TIMESTAMP(#{nowTime})) t2
		JOIN
		(SELECT count(m3.id) AS count4 FROM  t_wx_activity_lovearrow_main m3
		WHERE m3.bus_id = #{busId,jdbcType=INTEGER} AND UNIX_TIMESTAMP(m3.activity_end_time) &lt; UNIX_TIMESTAMP(#{nowTime})) t3
	</select>

</mapper>
