<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gt.game.core.dao.raiseflag.RaiseflagMainDAO">

	<!-- 通用查询映射结果 -->
	<resultMap id="BaseResultMap" type="com.gt.game.core.entity.raiseflag.RaiseflagMain">
		<id column="id" property="id" />
		<result column="createtime" property="createtime" />
		<result column="activity_begin_time" property="activityBeginTime" />
		<result column="activity_end_time" property="activityEndTime" />
		<result column="cash_prize_begin_time" property="cashPrizeBeginTime" />
		<result column="cash_prize_end_time" property="cashPrizeEndTime" />
		<result column="act_rule" property="actRule" />
		<result column="name" property="name" />
		<result column="follow_qr_code" property="followQrCode" />
		<result column="man_day_chance" property="manDayChance" />
		<result column="man_total_chance" property="manTotalChance" />
		<result column="music_url" property="musicUrl" />
		<result column="cash_prize_instruction" property="cashPrizeInstruction" />
		<result column="receive_type" property="receiveType" />
		<result column="phone" property="phone" />
		<result column="cash_address" property="cashAddress" />
		<result column="bus_id" property="busId" />
		<result column="rf_status" property="rfStatus" />
		<result column="prize_set_instruction" property="prizeSetInstruction" />
		<result column="is_sponsor" property="isSponsor" />
		<result column="sponsor_tips" property="sponsorTips" />
		<result column="is_join_prize" property="isJoinPrize" />
		<result column="join_prize_href" property="joinPrizeHref" />
		<result column="join_prize_tips" property="joinPrizeTips" />
		<result column="game_end_tips" property="gameEndTips" />
		<result column="join_prize_btn_tips" property="joinPrizeBtnTips" />
		<result column="authority_sign" property="authoritySign" />
		<result column="is_msg_template" property="isMsgTemplate" />
		<result column="msg_template_id" property="msgTemplateId" />
	</resultMap>
	<resultMap id="BaseResultMap1" type="com.gt.game.core.bean.raiseflag.res.RaiseflagListRes">
		<id column="id" property="id" />
		<result column="activity_begin_time" property="activityBeginTime" />
		<result column="activity_end_time" property="activityEndTime" />
		<result column="name" property="name" />
	</resultMap>
    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        id, createtime, activity_begin_time, activity_end_time, cash_prize_begin_time, cash_prize_end_time, act_rule, name, follow_qr_code, man_day_chance, man_total_chance, music_url, cash_prize_instruction, receive_type, phone, cash_address, bus_id, rf_status, prize_set_instruction, is_sponsor, sponsor_tips, is_join_prize, join_prize_href, join_prize_tips, game_end_tips, join_prize_btn_tips, authority_sign, is_msg_template, msg_template_id
    </sql>
	<select id="getRaiseflagList" resultMap="BaseResultMap1" parameterType="Map">
		SELECT  id,activity_begin_time, activity_end_time, name
		FROM t_wx_activity_raiseflag_main
		WHERE bus_id = #{busId,jdbcType=INTEGER}
		<if test="status == 0">
			and UNIX_TIMESTAMP(activity_begin_time) > UNIX_TIMESTAMP(#{nowTime})
		</if>
		<if  test="status == 1">
			and UNIX_TIMESTAMP(activity_begin_time) &lt;= UNIX_TIMESTAMP(#{nowTime}) and  UNIX_TIMESTAMP(activity_end_time) >= UNIX_TIMESTAMP(#{nowTime})
		</if>
		<if test="status == 2">
			and UNIX_TIMESTAMP(activity_end_time) &lt; UNIX_TIMESTAMP(#{nowTime})
		</if>
		<if test="name != null and name != ''">
			and name LIKE CONCAT('%','${name}','%' )
		</if>
		order BY  id DESC
	</select>
	<select id="getCount" resultType="map" parameterType="map">
		SELECT  t1.count2 ,t2.count3 , t3.count4
		FROM (SELECT  count(m1.id) AS count2 FROM  t_wx_activity_raiseflag_main m1
		WHERE m1.bus_id = #{busId,jdbcType=INTEGER} AND UNIX_TIMESTAMP(m1.activity_begin_time) > UNIX_TIMESTAMP(#{nowTime})) t1
		JOIN
		(SELECT count(m2.id) AS count3 FROM  t_wx_activity_raiseflag_main m2
		WHERE m2.bus_id = #{busId,jdbcType=INTEGER} 	and UNIX_TIMESTAMP(m2.activity_begin_time) &lt;= UNIX_TIMESTAMP(#{nowTime}) and  UNIX_TIMESTAMP(m2.activity_end_time) >= UNIX_TIMESTAMP(#{nowTime})) t2
		JOIN
		(SELECT count(m3.id) AS count4 FROM  t_wx_activity_raiseflag_main m3
		WHERE m3.bus_id = #{busId,jdbcType=INTEGER} AND UNIX_TIMESTAMP(m3.activity_end_time) &lt; UNIX_TIMESTAMP(#{nowTime})) t3
	</select>
</mapper>
