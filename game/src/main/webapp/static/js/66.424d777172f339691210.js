webpackJsonp([66],{"31jQ":function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var s=t("//Fk"),a=t.n(s),l=t("SJPh"),i={data:function(){return{loading:!1,active:"0",peopleNums:1,ruleForm1:{scrName:"",date:[],scrBeginTime:"",scrEndTime:"",scrPartaker:1,scrPway:0,scrMan:"",scrKou:"",scrDescribe:"",scrBeforeTxt:"",scrBgmName:"",scrBgm:""},rules1:{scrName:[{required:!0,message:"活动名称不能为空",trigger:"blur"}],date:[{required:!0,type:"array",message:"开始时间不能为空",trigger:"blur"}]},ruleForm2:{scrCountOfDay:"",scrCountOfAll:""},rules2:{scrCountOfDay:[{required:!0,type:"number",validator:this.$valid.elemIsInteger,trigger:"blur"}],scrCountOfAll:[{required:!0,type:"number",validator:this.$valid.elemIsInteger,trigger:"blur"}]},ruleForm3:{scrCashDay:"",scrAddress:"",scrCashWay:2,scrWinningTxt:"",scrWinningNotice:""},rules3:{scrCashDay:[{type:"number",required:!0,message:"兑奖期限不能为空",trigger:"blur"}],scrAddress:[{required:!0,message:"兑奖地址不能为空",trigger:"blur"}]},ruleForm4:[{scrPrizeType:5,scrPrizeLimit:"",scrPrizeName:"",scrPrizeNums:"",scrPrizeChance:"",nickname:""},{scrPrizeType:"",scrPrizeLimit:"",scrPrizeName:"",scrPrizeNums:"",scrPrizeChance:"",nickname:""}],options:[],dialogFans:!1,assignObj:{}}},methods:{assign:function(e){e.row.scrPrizeNums?(this.dialogFans=!0,this.assignObj=e.row,this.peopleNums=e.row.scrPrizeNums):this.$message.info("请先输入奖项数量")},getFansData:function(e){if(e.length){var r=[],t=[];e.forEach(function(e,s,a){r.push(e.nickname),t.push(e.openid)}),this.assignObj.nickname=r.join(","),this.assignObj.openid=t.join(","),this.$set(this.ruleForm4,this.assignObj.$index,this.assignObj)}},getMusic:function(e){this.ruleForm1.scrBgmName=e.music.name,this.ruleForm1.scrBgm=e.music.url},test:function(){this.dialogFans=!0},delForm4:function(e){this.ruleForm4.splice(e,1)},addForm4:function(){this.ruleForm4.push({scrPrizeType:"",scrPrizeLimit:"",scrPrizeName:"",scrPrizeNums:"",scrPrizeChance:"",nickname:""})},upStep:function(){this.active--},Save:function(e){var r=this;this.$refs[e].validate(function(e){if(!e)return!1;r.submit()})},lastStep:function(){for(var e=0;e<this.ruleForm4.length;e++){var r=/^[1-9]\d*$/;if(!(this.ruleForm4[e].scrPrizeLimit&&this.ruleForm4[e].scrPrizeName&&this.ruleForm4[e].scrPrizeNums&&this.ruleForm4[e].scrPrizeChance))return this.$message.error("表单不能留空，请填写完整~"),!1;if(!r.test(this.ruleForm4[e].scrPrizeLimit))return this.$message.error("奖品数额填写有误，请重新填写~"),!1;if(!r.test(this.ruleForm4[e].scrPrizeNums))return this.$message.error("奖项数量填写有误，请重新填写~"),!1;this.ruleForm4[e].scrPrizeChance=parseFloat(this.ruleForm4[e].scrPrizeChance).toFixed(2),this.submit()}},submit:function(){var e=this,r={id:this.$route.query.id,scrName:this.ruleForm1.scrName,scrBeginTime:this.ruleForm1.date[0],scrEndTime:this.ruleForm1.date[1],scrPartaker:this.ruleForm1.scrPartaker,scrPway:this.ruleForm1.scrPway,scrMan:this.ruleForm1.scrMan,scrKou:this.ruleForm1.scrKou,scrDescribe:this.ruleForm1.scrDescribe,scrBeforeTxt:this.ruleForm1.scrBeforeTxt,scrBgmName:this.ruleForm1.scrBgmName,scrBgm:this.ruleForm1.scrBgm,scrCountOfDay:this.ruleForm2.scrCountOfDay,scrCountOfAll:this.ruleForm2.scrCountOfAll,scrCashDay:this.ruleForm3.scrCashDay,scrAddress:this.ruleForm3.scrAddress,scrCashWay:this.ruleForm3.scrCashWay,scrWinningTxt:this.ruleForm3.scrWinningTxt,scrWinningNotice:this.ruleForm3.scrWinningNotice,prizeSetList:this.ruleForm4};this.loading=!0,Object(l.l)(r).then(function(r){100==r.code?e.$message.success("保存成功"):e.$message.error(r.msg||"保存失败"),e.loading=!1}).catch(function(){e.$message({type:"info",message:"网络问题，请刷新重试~"})})},backUrl:function(){window.history.go(-1)}},created:function(){var e=this;a.a.all([Object(l.g)({id:this.$route.query.id}),this.$api.getPrizeTypeThree()]).then(function(r){if(100==r[0].code){for(var t in e.ruleForm1)e.ruleForm1[t]=r[0].data[t]||"";e.ruleForm1.date=[r[0].data.scrBeginTime,r[0].data.scrEndTime];for(var s in e.ruleForm2)e.ruleForm2[s]=r[0].data[s]||"";for(var a in e.ruleForm3)e.ruleForm3[a]=r[0].data[a]||"";e.ruleForm4=r[0].data.prizeSetList}else e.$message.error("获取编辑数据失败");100==r[1].code?e.options=r[1].data:e.$message.error("获取奖品类型失败")})},filters:{prizeStatus:function(e){return 0==e?e="一等奖":1==e?e="二等奖":2==e?e="三等奖":3==e?e="四等奖":4==e?e="五等奖":5==e&&(e="六等奖"),e}}},o={render:function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("section",[t("div",{staticClass:"hd-common turnPlate"},[t("el-breadcrumb",{staticClass:"gt-crumbs",attrs:{separator:"/"}},[t("el-breadcrumb-item",{nativeOn:{click:function(r){e.$util.ClickApply(r)}}},[e._v("互动游戏")]),e._v(" "),t("el-breadcrumb-item",{attrs:{to:{path:"/scrapeHappy/index"}}},[e._v("刮刮乐")]),e._v(" "),t("el-breadcrumb-item",[e._v("编辑活动")])],1),e._v(" "),t("div",{staticClass:"gt-content"},[t("el-tabs",{attrs:{type:"card"},model:{value:e.active,callback:function(r){e.active=r},expression:"active"}},[t("el-tab-pane",{attrs:{label:"基础设置",name:"0"}}),e._v(" "),t("el-tab-pane",{attrs:{label:"规则设置",name:"1"}}),e._v(" "),t("el-tab-pane",{attrs:{label:"兑奖设置",name:"2"}}),e._v(" "),t("el-tab-pane",{attrs:{label:"奖项设置",name:"3"}})],1),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:0==this.active,expression:"this.active==0"}],staticClass:"mt40"},[t("el-form",{ref:"ruleForm1",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm1,rules:e.rules1,"label-width":"145px"}},[t("el-form-item",{attrs:{label:"活动名称：",prop:"scrName"}},[t("el-input",{staticClass:"w_demo",attrs:{placeholder:"请输入活动名称"},model:{value:e.ruleForm1.scrName,callback:function(r){e.$set(e.ruleForm1,"scrName",r)},expression:"ruleForm1.scrName"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"活动时间：",prop:"date"}},[t("el-date-picker",{staticClass:"w_demo",attrs:{editable:!1,type:"datetimerange",placeholder:"选择时间范围"},model:{value:e.ruleForm1.date,callback:function(r){e.$set(e.ruleForm1,"date",r)},expression:"ruleForm1.date"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"参与人员："}},[t("el-radio-group",{model:{value:e.ruleForm1.scrPartaker,callback:function(r){e.$set(e.ruleForm1,"scrPartaker",r)},expression:"ruleForm1.scrPartaker"}},[t("el-radio",{attrs:{label:1}},[e._v("所有粉丝")]),e._v(" "),t("el-radio",{attrs:{label:2}},[e._v("仅会员(持有会员卡的粉丝)")])],1)],1),e._v(" "),2==e.ruleForm1.scrPartaker?t("div",{staticClass:"pd20 bw pt10 bb ml150 mb20"},[t("el-form-item",{attrs:{label:"参与方式：","label-width":"100px"}},[t("el-radio-group",{staticClass:"mg-t10",model:{value:e.ruleForm1.scrPway,callback:function(r){e.$set(e.ruleForm1,"scrPway",r)},expression:"ruleForm1.scrPway"}},[t("el-radio",{attrs:{label:1}},[e._v("所有会员不需要积分")]),t("br"),t("br"),e._v(" "),t("el-radio",{attrs:{label:2}},[e._v("会员卡积分满"),t("el-input",{staticClass:"w100_demo ml10 mt20 mr10",attrs:{disabled:"2"!=e.ruleForm1.scrPway},model:{value:e.ruleForm1.scrMan,callback:function(r){e.$set(e.ruleForm1,"scrMan",r)},expression:"ruleForm1.scrMan"}}),e._v("即可参加（抽奖不扣除积分）")],1),t("br"),t("br"),e._v(" "),t("el-radio",{attrs:{label:3}},[e._v("每次抽奖扣除"),t("el-input",{staticClass:"w100_demo ml10 mt20 mr10",attrs:{disabled:"3"!=e.ruleForm1.scrPway},model:{value:e.ruleForm1.scrKou,callback:function(r){e.$set(e.ruleForm1,"scrKou",r)},expression:"ruleForm1.scrKou"}}),e._v("积分")],1),t("br"),t("br"),e._v(" "),t("el-radio",{attrs:{label:4}},[e._v("会员卡积分满"),t("el-input",{staticClass:"w100_demo ml10 mt20 mr10",attrs:{disabled:"4"!=e.ruleForm1.scrPway},model:{value:e.ruleForm1.scrMan,callback:function(r){e.$set(e.ruleForm1,"scrMan",r)},expression:"ruleForm1.scrMan"}}),e._v("分，\n                                             每次抽奖扣除"),t("el-input",{staticClass:"w100_demo ml10 mt20 mr10",attrs:{disabled:"4"!=e.ruleForm1.scrPway},model:{value:e.ruleForm1.scrKou,callback:function(r){e.$set(e.ruleForm1,"scrKou",r)},expression:"ruleForm1.scrKou"}}),e._v("分")],1)],1)],1)],1):e._e(),e._v(" "),t("el-form-item",{attrs:{label:"活动说明：",prop:"scrDescribe"}},[t("el-input",{staticClass:"w_demo",attrs:{type:"textarea",rows:3,placeholder:"描述活动详情，能让粉丝了解此次活动",maxlength:100},model:{value:e.ruleForm1.scrDescribe,callback:function(r){e.$set(e.ruleForm1,"scrDescribe",r)},expression:"ruleForm1.scrDescribe"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"活动未开始提示：",prop:"scrBeforeTxt"}},[t("el-input",{staticClass:"w_demo",attrs:{type:"textarea",rows:3,placeholder:"请控制字数在100以内，如：活动尚未开始，敬请期待!",maxlength:100},model:{value:e.ruleForm1.scrBeforeTxt,callback:function(r){e.$set(e.ruleForm1,"scrBeforeTxt",r)},expression:"ruleForm1.scrBeforeTxt"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"背景音乐："}},[t("div",{staticClass:"pd20 bb bw bgMusic"},[t("gt-material",{staticClass:"va-m",attrs:{prop:"",isMusic:!0,btnContent:"点击上传",width:"72",height:"72"},on:{getChangeUrl:e.getMusic}}),e._v(" "),t("span",{staticClass:"el-upload__tip c333 ml20"},[e._v(e._s(e.ruleForm1.scrBgmName))]),e._v(" "),t("div",{staticClass:"el-upload__tip grey",staticStyle:{"line-height":"25px"}},[e._v("\n                        音频文件的格式为mp3、wma、wav,大小不超过3M\n                    ")])],1)]),e._v(" "),t("el-form-item",[t("div",{staticClass:"btnRow"},[t("el-button",{attrs:{type:"primary",loading:e.loading},on:{click:function(r){e.Save("ruleForm2")}}},[e._v("保存")]),e._v(" "),t("el-button",{on:{click:e.backUrl}},[e._v("返回")])],1)])],1)],1),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:1==this.active,expression:"this.active==1"}],staticClass:"mt40"},[t("el-form",{ref:"ruleForm2",staticClass:"mt40 demo-ruleForm",attrs:{model:e.ruleForm2,rules:e.rules2,"label-width":"120px"}},[t("el-form-item",{attrs:{label:"抽奖次数：",prop:"scrCountOfDay"}},[t("el-input",{staticClass:"w_demo mr10",attrs:{placeholder:"请输入每人抽奖总次数"},model:{value:e.ruleForm2.scrCountOfDay,callback:function(r){e.$set(e.ruleForm2,"scrCountOfDay",e._n(r))},expression:"ruleForm2.scrCountOfDay"}}),e._v(" 次/人\n                ")],1),e._v(" "),t("el-form-item",{attrs:{label:"抽奖总数：",prop:"scrCountOfAll"}},[t("el-input",{staticClass:"w_demo mr10",attrs:{placeholder:"请输入每人/每天抽奖总数"},model:{value:e.ruleForm2.scrCountOfAll,callback:function(r){e.$set(e.ruleForm2,"scrCountOfAll",e._n(r))},expression:"ruleForm2.scrCountOfAll"}}),e._v("次/人\n                ")],1),e._v(" "),t("el-form-item",[t("div",{staticClass:"btnRow"},[t("el-button",{attrs:{type:"primary",loading:e.loading},on:{click:function(r){e.Save("ruleForm2")}}},[e._v("保存")]),e._v(" "),t("el-button",{on:{click:e.backUrl}},[e._v("返回")])],1)])],1)],1),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:2==this.active,expression:"this.active==2"}],staticClass:"mt40"},[t("el-form",{ref:"ruleForm3",staticClass:"mt40 demo-ruleForm",attrs:{model:e.ruleForm3,rules:e.rules3,"label-width":"120px"}},[t("el-form-item",{attrs:{label:"兑奖期限：",prop:"scrCashDay"}},[t("el-input",{staticClass:"w_demo mr10",attrs:{type:"number",placeholder:"请输入兑奖期限"},model:{value:e.ruleForm3.scrCashDay,callback:function(r){e.$set(e.ruleForm3,"scrCashDay",e._n(r))},expression:"ruleForm3.scrCashDay"}}),e._v("天\n                "),t("span",{staticClass:"el-upload__tip grey"},[e._v("\n                    从活动结束后开始计算\n                ")])],1),e._v(" "),t("el-form-item",{attrs:{label:"兑奖地址：",prop:"scrAddress"}},[t("el-input",{staticClass:"w_demo",attrs:{type:"textarea",rows:5,placeholder:"请输入兑奖地址"},model:{value:e.ruleForm3.scrAddress,callback:function(r){e.$set(e.ruleForm3,"scrAddress",r)},expression:"ruleForm3.scrAddress"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"兑奖方式："}},[t("el-select",{attrs:{placeholder:"请选择"},model:{value:e.ruleForm3.scrCashWay,callback:function(r){e.$set(e.ruleForm3,"scrCashWay",r)},expression:"ruleForm3.scrCashWay"}},[t("el-option",{attrs:{label:"自动发放",value:1}}),e._v(" "),t("el-option",{attrs:{label:"手动兑奖",value:2}})],1)],1),e._v(" "),t("el-form-item",{attrs:{label:"兑奖提示："}},[t("el-input",{staticClass:"w_demo",attrs:{maxlength:100,type:"textarea",rows:5,placeholder:"兑奖提示限制在100个字以内"},model:{value:e.ruleForm3.scrWinningTxt,callback:function(r){e.$set(e.ruleForm3,"scrWinningTxt",r)},expression:"ruleForm3.scrWinningTxt"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"中奖须知："}},[t("el-input",{staticClass:"w_demo",attrs:{maxlength:100,type:"textarea",rows:13,placeholder:"1、如果是实物的奖品，要填写中奖人的手机号码，如不是现场兑奖的还要填写速递地址。2、如中奖是流量的则要填写手机号码，流量将在12小时内到充值中奖人的手机号码上同时运营商会有流量到帐短信通知。3、如中奖是粉币或积分、优惠券的， 则中奖数额会即时自动累计到会员中心对应的类目上， 中奖人可到会员中心查看粉币或积分的增加数量。4、如果是转赠的，则要输入受赠人的手机号，同时受赠人要关注我们的微信公众号。5、中奖人须在规定的时间内完成兑奖，逾期则奖品自动作废。"},model:{value:e.ruleForm3.scrWinningNotice,callback:function(r){e.$set(e.ruleForm3,"scrWinningNotice",r)},expression:"ruleForm3.scrWinningNotice"}})],1),e._v(" "),t("el-form-item",[t("div",{staticClass:"btnRow"},[t("el-button",{attrs:{type:"primary",loading:e.loading},on:{click:function(r){e.Save("ruleForm2")}}},[e._v("保存")]),e._v(" "),t("el-button",{on:{click:e.backUrl}},[e._v("返回")])],1)])],1)],1),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:3==this.active,expression:"this.active==3"}],staticClass:"mt40"},[e._m(0),e._v(" "),t("div",{staticClass:"mt20 mb20"},[t("el-button",{attrs:{disabled:e.ruleForm4.length>4,type:"primary"},on:{click:e.addForm4}},[e._v("新增奖品")]),e._v(" "),t("span",{staticClass:"el-upload__tip grey ml10"},[e._v("最多设置五个奖项")])],1),e._v(" "),t("el-table",{ref:"multipleTable",attrs:{data:e.ruleForm4,"tooltip-effect":"dark"}},[t("el-table-column",{attrs:{label:"奖品类型",width:200},scopedSlots:e._u([{key:"default",fn:function(r){return[t("el-select",{staticClass:"w160",attrs:{placeholder:"请选择"},model:{value:r.row.scrPrizeType,callback:function(t){e.$set(r.row,"scrPrizeType",t)},expression:"scope.row.scrPrizeType"}},e._l(e.options,function(r){return 4!=r.value?t("el-option",{key:r.value,attrs:{label:r.name,value:r.value}}):e._e()}))]}}])}),e._v(" "),t("el-table-column",{attrs:{label:"奖品数额",width:200},scopedSlots:e._u([{key:"default",fn:function(r){return[t("el-input",{staticClass:"w150",attrs:{type:"number",placeholder:"数值应大于0"},model:{value:r.row.scrPrizeLimit,callback:function(t){e.$set(r.row,"scrPrizeLimit",t)},expression:"scope.row.scrPrizeLimit"}})]}}])}),e._v(" "),t("el-table-column",{attrs:{label:"奖项名称",width:240},scopedSlots:e._u([{key:"default",fn:function(r){return[t("el-input",{staticClass:"w20_demo",attrs:{placeholder:"请输入奖项名称"},model:{value:r.row.scrPrizeName,callback:function(t){e.$set(r.row,"scrPrizeName",t)},expression:"scope.row.scrPrizeName"}})]}}])}),e._v(" "),t("el-table-column",{attrs:{label:"奖项数量",width:200},scopedSlots:e._u([{key:"default",fn:function(r){return[t("el-input",{staticClass:"w150",attrs:{type:"number",placeholder:"数值应大于0"},model:{value:r.row.scrPrizeNums,callback:function(t){e.$set(r.row,"scrPrizeNums",e._n(t))},expression:"scope.row.scrPrizeNums"}})]}}])}),e._v(" "),t("el-table-column",{attrs:{label:"中奖概率(%)",width:200},scopedSlots:e._u([{key:"default",fn:function(r){return[t("el-input",{staticClass:"w160",attrs:{type:"number",placeholder:"0-100且保留两位小数"},model:{value:r.row.scrPrizeChance,callback:function(t){e.$set(r.row,"scrPrizeChance",t)},expression:"scope.row.scrPrizeChance"}})]}}])}),e._v(" "),t("el-table-column",{attrs:{label:"中奖人","min-width":"120"},scopedSlots:e._u([{key:"default",fn:function(r){return[e._v("\n                  "+e._s(r.row.nickname)+"\n                ")]}}])}),e._v(" "),t("el-table-column",{attrs:{label:"操作","min-width":"250"},scopedSlots:e._u([{key:"default",fn:function(r){return[t("el-button",{staticClass:"gt-button-normal blue",on:{click:function(t){e.assign(r)}}},[e._v("指定中奖人")]),e._v(" "),0!=r.$index?t("el-button",{staticClass:"gt-button-normal",on:{click:function(t){e.delForm4(r.$index)}}},[e._v("删除")]):e._e()]}}])})],1),e._v(" "),t("div",{staticClass:"btnRow"},[t("el-button",{attrs:{type:"primary",loading:e.loading},on:{click:function(r){e.Save("ruleForm2")}}},[e._v("保存")]),e._v(" "),t("el-button",{on:{click:e.backUrl}},[e._v("返回")])],1)],1),e._v(" "),t("div",{staticClass:"h80"}),e._v(" "),t("gt-Fans-detail",{attrs:{visible:e.dialogFans,peopleNums:e.peopleNums},on:{"update:visible":function(r){e.dialogFans=r},getFansData:e.getFansData}})],1)],1)])},staticRenderFns:[function(){var e=this.$createElement,r=this._self._c||e;return r("div",{staticClass:"gt-gray-region",staticStyle:{color:"#666","line-height":"20px"}},[r("p",[this._v("奖品数额：奖品的数量或内容；奖项数量：该奖品的可领取次数；中奖概率：每种奖项在转盘中的中奖概率")]),this._v(" "),r("p",[this._v("如：奖品类型：粉币；奖品数额：2；奖项名称：粉币；奖项数量：3；中奖概率：12")]),this._v(" "),r("p",[this._v("此次游戏活动设置了六个奖项：其中一个奖项为粉币(奖项名称)，该奖项出现3次(中奖数量)，中了该奖项会得到2个(奖品数额)粉币（奖品类型）。")]),this._v(" "),r("p",[this._v("当奖品为实物时，请上传实物图片，实物图片建议尺寸1160px*64px")])])}]};var c=t("VU/8")(i,o,!1,function(e){t("dVd/")},null,null);r.default=c.exports},"dVd/":function(e,r){}});