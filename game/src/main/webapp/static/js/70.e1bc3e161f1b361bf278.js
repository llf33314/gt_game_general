webpackJsonp([70],{LkDR:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r("lNUg"),l={data:function(){var e=this;return{active:0,ruleForm1:{name:"",date:""},rules1:{name:[{required:!0,message:"活动名称不能为空",trigger:"blur"}],date:[{required:!0,type:"array",message:"游戏时间不能为空",trigger:"blur"}]},ruleForm2:{followQrCode:"",manTotalChance:"",manDayChance:"",actRule:""},rules2:{manTotalChance:[{required:!0,message:"请填写每人免费游戏次数",trigger:"blur"}],manDayChance:[{required:!0,message:"请填写每人每天免费游戏次数",trigger:"blur"}],actRule:[{required:!0,message:"请填写活动规则",trigger:"blur"}]},ruleForm3:{PrizeDate:"",receiveTypeList:[],addressList:[{list:""}],phone:"",cashPrizeInstruction:""},rules3:{list:[{required:!0}],PrizeDate:[{required:!0,type:"array",message:"兑奖时间不能为空"}],receiveTypeList:[{required:!0,type:"array",message:"兑奖方式不能为空",trigger:"blur"}],phone:[{required:!0,type:"text",validator:function(t,r,a){return e.ruleForm3.phone?/^1[34578]\d{9}$/.test(r)||/^([0-9]{3,4}-)?[0-9]{7,8}$/.test(r)?void a():a("联系电话有误，请重填"):a(new Error("联系电话不能为空"))},trigger:"blur"}],cashPrizeInstruction:[{required:!0,message:"兑奖说明不能为空",trigger:"blur"}]},options:[],ruleForm4:[{type:"",prizeUnit:"",prizeName:"",num:"",probabiliy:"",imgUrl:[],cardReceiveId:""},{type:"",prizeUnit:"",prizeName:"",num:"",probabiliy:"",imgUrl:[],cardReceiveId:""}]}},methods:{addrPass:function(e,t,r){t?r():r(new Error("到店领取地址不能为空"))},phoneCheck:function(e,t,r){t?t.match(/^1[3|4|5|6|7|8][0-9][0-9]{8}$/)?r():r(new Error("请输入正确的手机号码")):r(new Error("联系电话不能为空"))},addList:function(){this.ruleForm3.addressList.push({list:""})},delList:function(e){this.ruleForm3.addressList.splice(e,1)},upStep:function(){this.active--},getChangeUrl2:function(e){this.ruleForm2.followQrCode=e.url},addAwardImg:function(e){JSON.parse(e.url).forEach(function(t,r,a){this.ruleForm4[e.prop.$index].imgUrl.push(t.url)},this)},getAwardImgList:function(e){e.url||this.ruleForm4[e.prop.$index].imgUrl.splice(e.sonIndex,1)},addForm4:function(){this.ruleForm4.push({type:"",prizeUnit:"",prizeName:"",num:"",probabiliy:"",imgUrl:[]})},delForm4:function(e){this.ruleForm4.splice(e,1)},Save:function(e){var t=this;this.$refs[e].validate(function(e){e?t.submit():console.log("error submit!!")})},lastStep:function(){for(var e=0,t=0;t<this.ruleForm4.length;t++){var r=/^[1-9]\d*$/;if(!(this.ruleForm4[t].type&&this.ruleForm4[t].prizeUnit&&this.ruleForm4[t].prizeName&&this.ruleForm4[t].num))return this.$message.error("表单不能留空，请填写完整~"),!1;if(!r.test(this.ruleForm4[t].prizeUnit))return this.$message.error("奖品单位填写有误，请重新填写~"),!1;if(!r.test(this.ruleForm4[t].num))return this.$message.error("奖项数量填写有误，请重新填写~"),!1;if(4==this.ruleForm4[t].type&&0==this.ruleForm4[t].imgUrl.length)return this.$message.error("当奖品为实物时，请上传实物图片~"),!1;e+=Number(this.ruleForm4[t].probabiliy)}if(100!=e)return this.$message.error("中奖概率之和加起来应为100%"),!1;this.submit()},submit:function(){var e=this,t=[];if(this.ruleForm3.addressList)for(var r=0;r<this.ruleForm3.addressList.length;r++)t.push(this.ruleForm3.addressList[r].list);var l={id:0,name:this.ruleForm1.name,activityBeginTime:this.ruleForm1.date[0],activityEndTime:this.ruleForm1.date[1],followQrCode:this.ruleForm2.followQrCode,manTotalChance:Number(this.ruleForm2.manTotalChance),manDayChance:Number(this.ruleForm2.manDayChance),actRule:this.ruleForm2.actRule,cashPrizeBeginTime:this.ruleForm3.PrizeDate[0],cashPrizeEndTime:this.ruleForm3.PrizeDate[1],receiveTypeList:this.ruleForm3.receiveTypeList,phone:this.ruleForm3.phone,cashPrizeInstruction:this.ruleForm3.cashPrizeInstruction,addressList:t,prizeSetList:this.ruleForm4};a.a.addActivity(l).then(function(t){100==t.code?e.$message.success("保存成功"):e.$message.error(t.msg||"保存失败")})},backUrl:function(){window.history.go(-1)}},created:function(){var e=this;a.a.getActivityById({id:this.$route.query.id}).then(function(t){if(100==t.code){for(var r in e.ruleForm1)e.ruleForm1[r]=t.data[r]||"";e.ruleForm1.date=[t.data.activityBeginTime,t.data.activityEndTime];for(var a in e.ruleForm2)e.ruleForm2[a]=t.data[a]||"";for(var l in e.ruleForm3)e.ruleForm3[l]=t.data[l]||"";if(e.ruleForm3.PrizeDate=[t.data.cashPrizeBeginTime,t.data.cashPrizeEndTime],e.ruleForm3.addressList.length)for(var i=0;i<e.ruleForm3.addressList.length;i++)e.ruleForm3.addressList[i]={list:e.ruleForm3.addressList[i]};else e.ruleForm3.addressList=[{list:""}];e.ruleForm4=t.data.prizeSetList}else e.$message.error("获取编辑数据失败")}),this.$api.getPrizeTypeOne().then(function(t){100==t.code?(t.data.push({value:5,name:"谢谢参与"}),e.options=t.data):e.$message.error(t.msg||"获取奖品类型失败")}),this.$api.getCardReceviceList().then(function(t){100==t.code?(t.data.forEach(function(e,t,r){e.id=parseInt(e.id)}),e.options1=t.data):e.$message.error(t.msg||"获取优惠券列表失败")})}},i={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("section",[r("div",{staticClass:"hd-common"},[r("el-breadcrumb",{staticClass:"gt-crumbs",attrs:{separator:"/"}},[r("el-breadcrumb-item",{nativeOn:{click:function(t){e.$util.ClickApply(t)}}},[e._v("互动游戏")]),e._v(" "),r("el-breadcrumb-item",{attrs:{to:{path:"/luckyNine/index"}}},[e._v("幸运九宫格")]),e._v(" "),r("el-breadcrumb-item",[e._v("编辑活动")])],1),e._v(" "),r("div",{staticClass:"gt-content"},[r("el-tabs",{attrs:{type:"card"},model:{value:e.active,callback:function(t){e.active=t},expression:"active"}},[r("el-tab-pane",{attrs:{label:"基础设置",name:"0"}}),e._v(" "),r("el-tab-pane",{attrs:{label:"规则设置",name:"1"}}),e._v(" "),r("el-tab-pane",{attrs:{label:"兑奖设置",name:"2"}}),e._v(" "),r("el-tab-pane",{attrs:{label:"奖项设置",name:"3"}})],1),e._v(" "),0==this.active?r("div",{staticClass:"mt40"},[r("el-form",{ref:"ruleForm1",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm1,rules:e.rules1,"label-width":"120px"}},[r("el-form-item",{attrs:{label:"活动名称：",prop:"name"}},[r("el-input",{staticClass:"w_demo",attrs:{placeholder:"请输入活动名称",maxlength:25},model:{value:e.ruleForm1.name,callback:function(t){e.$set(e.ruleForm1,"name",t)},expression:"ruleForm1.name"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"活动时间：",prop:"date"}},[r("el-date-picker",{staticClass:"w_demo",attrs:{editable:!1,type:"datetimerange",placeholder:"选择时间范围"},model:{value:e.ruleForm1.date,callback:function(t){e.$set(e.ruleForm1,"date",t)},expression:"ruleForm1.date"}})],1)],1),e._v(" "),r("div",{staticClass:"btnRow"},[r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.Save("ruleForm1")}}},[e._v("保存")]),e._v(" "),r("el-button",{on:{click:e.backUrl}},[e._v("返回")])],1)],1):e._e(),e._v(" "),1==this.active?r("div",{staticClass:"mt40"},[r("el-form",{ref:"ruleForm2",staticClass:"mt40 demo-ruleForm",attrs:{model:e.ruleForm2,rules:e.rules2,"label-width":"150px"}},[r("el-form-item",{attrs:{label:"关注二维码：",prop:"followQrCode"}},[r("gt-material",{attrs:{prop:"url",url:e.ruleForm2.followQrCode,width:"72",height:"72"},on:{getChangeUrl:e.getChangeUrl2}}),e._v(" "),r("span",{staticClass:"el-upload__tip grey ml10"},[e._v("上传1:1二维码，将会在活动规则中显示商家二维码")])],1),e._v(" "),r("el-form-item",{attrs:{label:"游戏总数：",prop:"manTotalChance"}},[r("el-input",{staticClass:"w25_demo mr10",attrs:{type:"number",placeholder:"请输入游戏总数",maxlength:10},nativeOn:{keydown:function(t){e.$util.KeydownNumber(t)}},model:{value:e.ruleForm2.manTotalChance,callback:function(t){e.$set(e.ruleForm2,"manTotalChance",t)},expression:"ruleForm2.manTotalChance"}}),e._v("次/人\r\n                ")],1),e._v(" "),r("el-form-item",{attrs:{label:"每天次数：",prop:"manDayChance"}},[r("el-input",{staticClass:"w25_demo mr10",attrs:{type:"number",placeholder:"请输入每天游戏次数）",maxlength:10},nativeOn:{keydown:function(t){e.$util.KeydownNumber(t)}},model:{value:e.ruleForm2.manDayChance,callback:function(t){e.$set(e.ruleForm2,"manDayChance",t)},expression:"ruleForm2.manDayChance"}}),e._v("次/人\r\n                ")],1),e._v(" "),r("el-form-item",{attrs:{label:"活动规则：",prop:"actRule"}},[r("el-input",{staticClass:"w_demo",attrs:{maxlength:300,type:"textarea",rows:3,placeholder:"请填写活动规则"},model:{value:e.ruleForm2.actRule,callback:function(t){e.$set(e.ruleForm2,"actRule",t)},expression:"ruleForm2.actRule"}}),e._v(" "),r("span",{staticClass:"el-upload__tip grey ml10"},[e._v("300个字以内")])],1)],1),e._v(" "),r("div",{staticClass:"btnRow"},[r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.Save("ruleForm2")}}},[e._v("保存")]),e._v(" "),r("el-button",{on:{click:e.backUrl}},[e._v("返回")])],1)],1):e._e(),e._v(" "),2==this.active?r("div",{staticClass:"mt40"},[r("el-form",{ref:"ruleForm3",staticClass:"mt40 demo-ruleForm",attrs:{model:e.ruleForm3,rules:e.rules3,"label-width":"120px"}},[r("el-form-item",{attrs:{label:"兑奖时间：",prop:"PrizeDate"}},[r("el-date-picker",{staticClass:"w_demo",attrs:{type:"daterange",placeholder:"选择日期范围"},model:{value:e.ruleForm3.PrizeDate,callback:function(t){e.$set(e.ruleForm3,"PrizeDate",t)},expression:"ruleForm3.PrizeDate"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"兑奖方式：",prop:"receiveTypeList"}},[r("el-checkbox-group",{model:{value:e.ruleForm3.receiveTypeList,callback:function(t){e.$set(e.ruleForm3,"receiveTypeList",t)},expression:"ruleForm3.receiveTypeList"}},[r("el-checkbox",{attrs:{label:"1",name:"1"}},[e._v("到店领取")]),e._v(" "),r("el-checkbox",{attrs:{label:"2",name:"2"}},[e._v("邮寄")])],1)],1),e._v(" "),1==this.ruleForm3.receiveTypeList[0]||1==this.ruleForm3.receiveTypeList[1]?r("div",{staticClass:"bb pt20 pb20 ml120 bw mb10"},[r("span",{staticStyle:{"margin-left":"30px",color:"#333"}},[r("span",{staticStyle:{color:"#ff4949","margin-right":"3px"}},[e._v("*")]),e._v("兑奖地址：")]),e._v(" "),r("el-button",{staticClass:"mb10",attrs:{type:"primary"},on:{click:function(t){e.addList()}}},[e._v("添加")]),e._v(" "),e._l(e.ruleForm3.addressList,function(t,a){return r("el-form-item",{key:t.key,attrs:{prop:"addressList."+a+".list",rules:{required:!0,validator:e.addrPass,trigger:"blur"}}},[r("el-input",{staticClass:"w_demo mr10",attrs:{prop:"list",placeholder:"请输入到店领取地址",maxlength:100},model:{value:t.list,callback:function(r){e.$set(t,"list",r)},expression:"item.list"}}),e._v(" "),0!=a?r("span",{staticClass:"blueee",on:{click:function(t){e.delList(a)}}},[e._v("删除")]):e._e()],1)})],2):e._e(),e._v(" "),r("el-form-item",{attrs:{label:"联系电话：",prop:"phone"}},[r("el-input",{staticClass:"w_demo",attrs:{placeholder:"请输入联系电话(固话用-分割)",maxlength:20},nativeOn:{keydown:function(t){e.$util.KeydownNumber(t)}},model:{value:e.ruleForm3.phone,callback:function(t){e.$set(e.ruleForm3,"phone",t)},expression:"ruleForm3.phone"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"兑奖说明：",prop:"cashPrizeInstruction"}},[r("el-input",{staticClass:"bw",attrs:{type:"textarea",rows:5,placeholder:"请输入兑奖说明",maxlength:200},model:{value:e.ruleForm3.cashPrizeInstruction,callback:function(t){e.$set(e.ruleForm3,"cashPrizeInstruction",t)},expression:"ruleForm3.cashPrizeInstruction"}})],1)],1),e._v(" "),r("div",{staticClass:"btnRow"},[r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.Save("ruleForm3")}}},[e._v("保存")]),e._v(" "),r("el-button",{on:{click:e.backUrl}},[e._v("返回")])],1)],1):e._e(),e._v(" "),3==this.active?r("div",{staticClass:"mt40"},[e._m(0),e._v(" "),r("div",{staticClass:"mt20 mb20"},[r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.addForm4()}}},[e._v("新增奖品")]),e._v(" "),r("span",{staticClass:"el-upload__tip grey ml10"},[e._v("下列奖品根据排名由上至下顺序分配")])],1),e._v(" "),r("el-tooltip",{attrs:{placement:"top",effect:"light"}},[r("div",{attrs:{slot:"content"},slot:"content"},[e._v("\r\n                    当奖品为实物时，请上传实物图片\r\n                ")]),e._v(" "),r("span",{staticClass:"el-icon-warning",staticStyle:{"font-size":"18px","margin-left":"67%","z-index":"11",position:"absolute","margin-top":"12px",color:"#ccc"}})]),e._v(" "),r("el-table",{ref:"multipleTable",attrs:{data:e.ruleForm4,"tooltip-effect":"dark"}},[r("el-table-column",{attrs:{label:"奖品类型",width:220},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-select",{attrs:{placeholder:"请选择"},model:{value:t.row.type,callback:function(r){e.$set(t.row,"type",r)},expression:"scope.row.type"}},e._l(e.options,function(e){return r("el-option",{key:e.value,attrs:{label:e.name,value:e.value}})}))]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"奖品单位",width:240},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-input",{staticClass:"w20_demo",attrs:{type:"number",placeholder:"数值应大于0",maxlength:10},nativeOn:{keydown:function(t){e.$util.KeydownNumber(t)}},model:{value:t.row.prizeUnit,callback:function(r){e.$set(t.row,"prizeUnit",r)},expression:"scope.row.prizeUnit"}})]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"奖品名称",width:240},scopedSlots:e._u([{key:"default",fn:function(t){return[7!=t.row.type?r("el-input",{staticClass:"w20_demo",attrs:{placeholder:"请输入奖品名称",maxlength:50},model:{value:t.row.prizeName,callback:function(r){e.$set(t.row,"prizeName",r)},expression:"scope.row.prizeName"}}):r("el-select",{attrs:{placeholder:"请选择"},model:{value:t.row.cardReceiveId,callback:function(r){e.$set(t.row,"cardReceiveId",e._n(r))},expression:"scope.row.cardReceiveId"}},e._l(e.options1,function(e){return r("el-option",{key:e.id,attrs:{label:e.cardsName,value:e.id}})}))]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"奖项数量",width:240},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-input",{staticClass:"w20_demo",attrs:{type:"number",placeholder:"数值应大于0",maxlength:10},nativeOn:{keydown:function(t){e.$util.KeydownNumber(t)}},model:{value:t.row.num,callback:function(r){e.$set(t.row,"num",r)},expression:"scope.row.num"}})]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"中奖概率(%)",width:200},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-input",{staticClass:"w160",attrs:{type:"number",placeholder:"0-100且保留两位小数"},model:{value:t.row.probabiliy,callback:function(r){e.$set(t.row,"probabiliy",r)},expression:"scope.row.probabiliy"}})]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"奖品图片",width:160},scopedSlots:e._u([{key:"default",fn:function(t){return 4==t.row.type?[e._l(t.row.imgUrl,function(a,l){return r("gt-material",{key:l,staticClass:"mr10",attrs:{prop:t,sonIndex:l,selectType:"radio",url:a,width:"50",height:"50"},on:{getChangeUrl:e.getAwardImgList}})}),e._v(" "),r("gt-material",{staticClass:"uploadBtn",attrs:{prop:t,selectType:"select",width:"50",height:"50"},on:{getChangeUrl:e.addAwardImg}})]:void 0}}])}),e._v(" "),r("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[0!=t.$index?r("el-button",{staticClass:"gt-button-normal",on:{click:function(r){e.delForm4(t.$index)}}},[e._v("删除")]):e._e()]}}])})],1),e._v(" "),r("div",{staticClass:"btnRow"},[r("el-button",{attrs:{type:"primary"},on:{click:e.lastStep}},[e._v("保存")]),e._v(" "),r("el-button",{on:{click:e.backUrl}},[e._v("返回")])],1)],1):e._e(),e._v(" "),r("div",{staticClass:"h80"})],1)],1)])},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"gt-gray-region mt20",staticStyle:{color:"#666","line-height":"20px"}},[t("p",[this._v("奖品类型：奖品的内容;奖品单位：奖品的数量货内容；奖项数量:该奖品的可领取次数")]),this._v(" "),t("p",[this._v("如：奖品类型：粉币；奖品数额：2；奖项名称：粉币；奖项数量：3；中奖概率：12")]),this._v(" "),t("p",[this._v("当奖品为实物时，请上传实物图片，实物图片建议尺寸1160px*64px")])])}]};var s=r("VU/8")(l,i,!1,function(e){r("kXw8")},null,null);t.default=s.exports},kXw8:function(e,t){}});